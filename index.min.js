function updateMenu(){var e=document.getElementById("undo");currentGameIndex>0?e.classList.remove("inactive"):e.classList.add("inactive");var r=document.getElementById("redo");currentGameIndex==currentGameHistory.length-1?r.classList.add("inactive"):r.classList.remove("inactive")}function updateField(e){prevField=currentField,prevField&&prevField.classList.remove("active"),currentField=document.getElementById(e),currentField.classList.add("active"),updateMenu()}function updatePlayer(e){var r=document.getElementById("field-a-l");r.innerText=e.A.p[0];var t=document.getElementById("field-a-r");t.innerText=e.A.p[1];var n=document.getElementById("field-b-l");n.innerText=e.B.p[0];var c=document.getElementById("field-b-r");c.innerText=e.B.p[1]}function updateScore(e){var r=document.getElementById("score-a");r.innerText=String(e.A.s).padStart(2,"0");var t=document.getElementById("score-b");t.innerText=String(e.B.s).padStart(2,"0");var n=document.getElementById("win-a");n.innerText=String(e.A.w).padStart(2,"0");var c=document.getElementById("win-b");c.innerText=String(e.B.w).padStart(2,"0")}function resetGame(){currentScores.A.s=0,currentScores.B.s=0,currentGameIndex=0,currentGameHistory=[{A:{d:0,p:[2,1]},B:{d:0,p:[2,1]}}],currentMaxScore=defaultMaxScore}function shiftGame(e){var r=null;if(e<0){if(0==currentGameIndex)return;r=currentGameHistory[currentGameIndex],currentScores.A.s-=r.A.d,currentScores.B.s-=r.B.d,currentGameIndex--,r=currentGameHistory[currentGameIndex]}else{if(currentGameIndex==currentGameHistory.length-1)return;currentGameIndex++,r=currentGameHistory[currentGameIndex],currentScores.A.s+=r.A.d,currentScores.B.s+=r.B.d}updateScore(currentScores),r.A.d>0?updateField(currentScores.A.s%2==0?"field-a-r":"field-a-l"):updateField(currentScores.B.s%2==0?"field-b-r":"field-b-l"),updatePlayer(r)}function checkScore(e,r){e.A.s==currentMaxScore||e.B.s==currentMaxScore?(resetGame(),updateScore(e),updateField(e.A.w<e.B.w?"field-a-r":"field-b-r"),updatePlayer(currentGameHistory[currentGameIndex])):(e.A.s==e.B.s?(e.A.s>=20&&(currentMaxScore=e.A.s+2),0==e.A.s?updateField(e.A.w<e.B.w?"field-a-r":"field-b-r"):r.A.d>0?updateField(e.A.s%2==0?"field-a-r":"field-a-l"):updateField(e.B.s%2==0?"field-b-r":"field-b-l")):r.A.d>0?updateField(e.A.s%2==0?"field-a-r":"field-a-l"):updateField(e.B.s%2==0?"field-b-r":"field-b-l"),updatePlayer(r)),localStorage.setItem("scores",JSON.stringify(e))}function getScoreInfo(){var e=localStorage.getItem("scores");e&&(currentScores=JSON.parse(e));var r=localStorage.getItem("history");if(r){currentGameHistory=JSON.parse(r),currentGameIndex=currentGameHistory.length-1;var t=currentGameHistory[currentGameIndex],n=currentGameHistory[currentGameIndex].A.d>0;updateField(n?currentScores.A.s%2==0?"field-a-r":"field-a-l":currentScores.B.s%2==0?"field-b-r":"field-b-l",t)}updateScore(currentScores),checkScore(currentScores,currentGameHistory[currentGameIndex])}function pushGameHistory(e){currentGameHistory.push(structuredClone(e)),localStorage.setItem("history",JSON.stringify(currentGameHistory)),currentGameIndex++}function increaseScore(e){if(99!=currentScores.A.s&&99!=currentScores.B.s&&99!=currentScores.A.w&&99!=currentScores.B.w){currentGameIndex!=currentGameHistory.length-1&&(currentGameHistory=currentGameHistory.slice(0,currentGameIndex+1));var r=structuredClone(currentGameHistory[currentGameIndex]),t=r.A.d>0;switch(e){case"score-a":currentScores.A.s+=1,currentScores.A.s==currentMaxScore&&(currentScores.A.w+=1),r.A.d=1,r.B.d=0,t&&r.A.p.reverse();break;case"score-b":currentScores.B.s+=1,currentScores.B.s==currentMaxScore&&(currentScores.B.w+=1),r.A.d=0,r.B.d=1,t||r.B.p.reverse()}pushGameHistory(r),updateScore(currentScores),checkScore(currentScores,r)}}function resetAllGames(){currentScores={A:{s:0,w:0},B:{s:0,w:0}},resetGame(),updateScore(currentScores),checkScore(currentScores,currentGameHistory[currentGameIndex]),localStorage.removeItem("history")}var noSleep=new NoSleep;const defaultMaxScore=21;var currentScores={A:{s:0,w:0},B:{s:0,w:0}},currentMaxScore=defaultMaxScore,prevField=null,currentField=null,currentGameIndex=0,currentGameHistory=[{A:{d:0,p:[2,1]},B:{d:0,p:[2,1]}}],resetTimeoutHandle=null;document.addEventListener("readystatechange",()=>{"complete"==document.readyState&&(alert("wakeLock"in navigator),document.addEventListener("click",function e(){document.removeEventListener("click",e,!1),noSleep.enable()},!1))}),document.addEventListener("DOMContentLoaded",()=>{"serviceWorker"in navigator&&navigator.serviceWorker.register("/scoreboard-web/sw.min.js").then(e=>{e.installing&&setTimeout(()=>{window.location.reload()},1e3)}),getScoreInfo();for(var e=document.getElementsByClassName("score"),r=0;r<e.length;r++)e[r].addEventListener("click",e=>{increaseScore(e.target.id)});var t=document.getElementById("reset"),n="mousedown",c="mouseup";"ontouchstart"in window&&(n="touchstart",c="touchend"),t.addEventListener(n,e=>{resetTimeoutHandle=setTimeout(resetAllGames,3e3)}),t.addEventListener(c,e=>{resetTimeoutHandle&&(clearTimeout(resetTimeoutHandle),resetTimeoutHandle=null)});var a=document.getElementById("reload");a.addEventListener("click",e=>{window.location.reload()});var d=document.getElementById("undo");d.addEventListener("click",e=>{shiftGame(-1)});var o=document.getElementById("redo");o.addEventListener("click",e=>{shiftGame(1)})});