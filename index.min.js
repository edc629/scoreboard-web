function updateMenu(){var e=document.getElementById("undo");currentGameIndex>0?e.classList.remove("inactive"):e.classList.add("inactive");var r=document.getElementById("redo");currentGameIndex==currentGameHistory.length-1?r.classList.add("inactive"):r.classList.remove("inactive")}function updateField(e){if(prevField=currentField,prevField)for(var r=0;r<prevField.length;r++)prevField[r].classList.remove("active");currentField=document.getElementsByClassName(e);for(r=0;r<currentField.length;r++)currentField[r].classList.add("active");updateMenu()}function updatePlayer(e){for(var r=document.getElementsByClassName("player a l"),t=0;t<r.length;t++)r[t].innerText=e.A.p[0];var n=document.getElementsByClassName("player a r");for(t=0;t<n.length;t++)n[t].innerText=e.A.p[1];var a=document.getElementsByClassName("player b l");for(t=0;t<a.length;t++)a[t].innerText=e.B.p[0];var c=document.getElementsByClassName("player b r");for(t=0;t<c.length;t++)c[t].innerText=e.B.p[1]}function updateScore(e){for(var r=document.getElementsByClassName("score a"),t=0;t<r.length;t++)r[t].innerText=String(e.A.s).padStart(2,"0");var n=document.getElementsByClassName("score b");for(t=0;t<n.length;t++)n[t].innerText=String(e.B.s).padStart(2,"0");var a=document.getElementsByClassName("win a");for(t=0;t<a.length;t++)a[t].innerText=String(e.A.w).padStart(2,"0");var c=document.getElementsByClassName("win b");for(t=0;t<c.length;t++)c[t].innerText=String(e.B.w).padStart(2,"0")}function resetGame(){currentScores.A.s=0,currentScores.B.s=0,currentGameIndex=0,currentGameHistory=[{A:{d:0,p:[2,1]},B:{d:0,p:[2,1]}}],currentMaxScore=defaultMaxScore}function shiftGame(e){var r=null;if(e<0){if(0==currentGameIndex)return;r=currentGameHistory[currentGameIndex],currentScores.A.s-=r.A.d,currentScores.B.s-=r.B.d,currentGameIndex--,r=currentGameHistory[currentGameIndex]}else{if(currentGameIndex==currentGameHistory.length-1)return;currentGameIndex++,r=currentGameHistory[currentGameIndex],currentScores.A.s+=r.A.d,currentScores.B.s+=r.B.d}updateScore(currentScores),r.A.d>0?updateField(currentScores.A.s%2==0?"player a r":"player a l"):updateField(currentScores.B.s%2==0?"player b r":"player b l"),updatePlayer(r)}function checkScore(e,r){if(e.A.s==currentMaxScore||e.B.s==currentMaxScore){var t=document.getElementById("whistle-blow");t&&"up"==currentVolume&&t.play(),resetGame(),updateScore(e),updateField(e.A.w<e.B.w?"player a r":"player b r"),updatePlayer(currentGameHistory[currentGameIndex])}else e.A.s==e.B.s?(e.A.s>=20&&(currentMaxScore=e.A.s+2),0==e.A.s?updateField(e.A.w<e.B.w?"player a r":"player b r"):r.A.d>0?updateField(e.A.s%2==0?"player a r":"player a l"):updateField(e.B.s%2==0?"player b r":"player b l")):r.A.d>0?updateField(e.A.s%2==0?"player a r":"player a l"):updateField(e.B.s%2==0?"player b r":"player b l"),updatePlayer(r);localStorage.setItem("scores",JSON.stringify(e))}function getScoreInfo(){var e=localStorage.getItem("scores");e&&(currentScores=JSON.parse(e));var r=localStorage.getItem("volume");r&&(currentVolume=r,document.getElementById("volume").innerText="volume_"+currentVolume);var t=localStorage.getItem("history");if(t){currentGameHistory=JSON.parse(t),currentGameIndex=currentGameHistory.length-1;var n=currentGameHistory[currentGameIndex],a=currentGameHistory[currentGameIndex].A.d>0;updateField(a?currentScores.A.s%2==0?"player a r":"player a l":currentScores.B.s%2==0?"player b r":"player b l",n)}updateScore(currentScores),checkScore(currentScores,currentGameHistory[currentGameIndex])}function pushGameHistory(e){currentGameHistory.push(structuredClone(e)),localStorage.setItem("history",JSON.stringify(currentGameHistory)),currentGameIndex++}function increaseScore(e){if(99!=currentScores.A.s&&99!=currentScores.B.s&&99!=currentScores.A.w&&99!=currentScores.B.w){currentGameIndex!=currentGameHistory.length-1&&(currentGameHistory=currentGameHistory.slice(0,currentGameIndex+1));var r=structuredClone(currentGameHistory[currentGameIndex]),t=r.A.d>0;"object"==typeof e&&e.classList.contains("a")||"a"==e?(currentScores.A.s+=1,currentScores.A.s==currentMaxScore&&(currentScores.A.w+=1),r.A.d=1,r.B.d=0,t&&r.A.p.reverse()):("object"==typeof e&&e.classList.contains("b")||"b"==e)&&(currentScores.B.s+=1,currentScores.B.s==currentMaxScore&&(currentScores.B.w+=1),r.A.d=0,r.B.d=1,t||r.B.p.reverse()),pushGameHistory(r),updateScore(currentScores),checkScore(currentScores,r)}}function resetAllGames(){currentScores={A:{s:0,w:0},B:{s:0,w:0}},resetGame(),updateScore(currentScores),checkScore(currentScores,currentGameHistory[currentGameIndex]),localStorage.removeItem("history")}function toggleVolume(e){null==e&&(e=document.getElementById("volume")),currentVolume="up"==currentVolume?"off":"up",e.innerText="volume_"+currentVolume,localStorage.setItem("volume",currentVolume)}function waitForResetAllGames(){null==resetTimeoutHandle&&(resetTimeoutHandle=setTimeout(resetAllGames,3e3))}function cancelResetAllGames(){resetTimeoutHandle&&(clearTimeout(resetTimeoutHandle),resetTimeoutHandle=null)}var noSleep=new NoSleep(!0);const defaultMaxScore=21;var currentScores={A:{s:0,w:0},B:{s:0,w:0}},currentMaxScore=defaultMaxScore,prevField=null,currentField=null,currentGameIndex=0,currentGameHistory=[{A:{d:0,p:[2,1]},B:{d:0,p:[2,1]}}],resetTimeoutHandle=null,currentVolume="off";document.addEventListener("readystatechange",()=>{"complete"==document.readyState&&document.addEventListener("click",function e(){document.removeEventListener("click",e,!1),noSleep.enable()},!1)}),document.addEventListener("DOMContentLoaded",()=>{var e=-1==window.location.search.indexOf("nocache=1")&&"serviceWorker"in navigator;e&&(navigator.serviceWorker.addEventListener("message",e=>{"installed"==e.data&&window.location.reload()}),navigator.serviceWorker.register("/scoreboard-web/sw.min.js")),getScoreInfo(),document.addEventListener("keydown",e=>{switch(e.key){case",":shiftGame(-1);break;case".":shiftGame(1);break;case"Delete":waitForResetAllGames();break;case"V":case"v":toggleVolume();break;case"B":case"b":increaseScore("a");break;case"R":case"r":increaseScore("b")}}),document.addEventListener("keyup",e=>{"Delete"==e.key&&cancelResetAllGames()});for(var r=document.getElementsByClassName("score"),t=0;t<r.length;t++)r[t].addEventListener("click",e=>{increaseScore(e.target)});var n=document.getElementById("reset"),a="mousedown",c="mouseup";"ontouchstart"in window&&(a="touchstart",c="touchend"),n.addEventListener(a,waitForResetAllGames),n.addEventListener(c,cancelResetAllGames);var s=document.getElementById("reload");s.addEventListener("click",r=>{e&&navigator.serviceWorker.controller.postMessage("delete-cache")});var o=document.getElementById("undo");o.addEventListener("click",e=>{shiftGame(-1)});var l=document.getElementById("redo");l.addEventListener("click",e=>{shiftGame(1)});var u=document.getElementById("volume");u.addEventListener("click",e=>{toggleVolume(e.target)})});